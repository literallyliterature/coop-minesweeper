(function(e){function n(n){for(var o,s,c=n[0],a=n[1],l=n[2],d=0,f=[];d<c.length;d++)s=c[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&f.push(r[s][0]),r[s]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);u&&u(n);while(f.length)f.shift()();return i.push.apply(i,l||[]),t()}function t(){for(var e,n=0;n<i.length;n++){for(var t=i[n],o=!0,c=1;c<t.length;c++){var a=t[c];0!==r[a]&&(o=!1)}o&&(i.splice(n--,1),e=s(s.s=t[0]))}return e}var o={},r={app:0},i=[];function s(n){if(o[n])return o[n].exports;var t=o[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=e,s.c=o,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,n){if(1&n&&(e=s(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)s.d(t,o,function(n){return e[n]}.bind(null,o));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="/coop-minesweeper/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],a=c.push.bind(c);c.push=n,c=c.slice();for(var l=0;l<c.length;l++)n(c[l]);var u=a;i.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var o=t("2b0e"),r=t("fe3c"),i=t.n(r),s=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("v-app",{staticStyle:{background:"#171717"}},[t("v-app-bar",{attrs:{app:"",color:"#222"}},[e.$vuetify.breakpoint.smAndUp?t("div",{staticClass:"text-h6"},[e._v(" Minesweeper ")]):e._e(),t("v-spacer"),e.startedGame||e.conn?t("v-col",{attrs:{cols:"auto"}},[e._v(" "+e._s(e.remainingMines)+" ")]):e._e(),t("v-col",{attrs:{cols:"auto"}},[t("v-btn",{class:e.conn?"mr-4":"",attrs:{icon:""},on:{click:e.refresh}},[t("v-icon",[e._v(" mdi-refresh ")])],1)],1),t("v-col",{attrs:{cols:"auto"}},[t("v-switch",{staticClass:"mb-n5",scopedSlots:e._u([{key:"label",fn:function(){return[t("v-icon",[e._v(" mdi-cellphone ")])]},proxy:!0}]),model:{value:e.mobileMode,callback:function(n){e.mobileMode=n},expression:"mobileMode"}})],1),t("v-col",{attrs:{cols:"auto"}},[t("v-menu",{attrs:{"close-on-content-click":!1,"nudge-bottom":"16","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(n){var o=n.on,r=n.attrs;return[t("v-btn",e._g(e._b({attrs:{icon:""}},"v-btn",r,!1),o),[t("v-icon",[e._v(" mdi-cog ")])],1)]}}])},[t("v-card",{staticClass:"pa-4"},[t("v-text-field",{attrs:{label:"Rows",type:"number"},model:{value:e.numberOfRows,callback:function(n){e.numberOfRows=e._n(n)},expression:"numberOfRows"}}),t("v-text-field",{attrs:{label:"Columns",type:"number"},model:{value:e.numberOfCols,callback:function(n){e.numberOfCols=e._n(n)},expression:"numberOfCols"}}),t("v-text-field",{attrs:{label:"Mines",type:"number"},model:{value:e.numberOfMines,callback:function(n){e.numberOfMines=e._n(n)},expression:"numberOfMines"}}),e.conn?e._e():t("v-row",{attrs:{dense:""}},[t("v-col",[t("div",{staticClass:"text-body-2"},[e._v(" Share ID ")]),t("div",{staticClass:"text-caption text--secondary",attrs:{id:"share-id-div-in-menu"}},[e._v(" "+e._s(e.peerId)+" ")])]),t("v-col",{attrs:{cols:"auto"}},[t("v-btn",{attrs:{icon:""},on:{click:function(n){return e.copyToClipboard("share-id-div-in-menu")}}},[t("v-icon",[e._v(" mdi-content-copy ")])],1)],1)],1)],1)],1)],1)],1),t("v-main",{staticClass:"mx-4",staticStyle:{overflow:"auto"}},[t("PeerConnector",{directives:[{name:"show",rawName:"v-show",value:!e.startedGame&&!e.conn,expression:"!startedGame && !conn"}],on:{connected:e.handleConnection,"copy-to-clipboard":e.copyToClipboard,peer:function(n){return e.peerId=n},"start-game":function(n){e.startedGame=!0}}}),e.startedGame||e.conn?t("Minesweeper",{key:e.minesKey,ref:"mines",attrs:{"mobile-mode":e.mobileMode,"number-of-cols":e.numberOfCols,"number-of-mines":e.numberOfMines,"number-of-rows":e.numberOfRows},on:{"game-lost":function(n){return e.showSnackbar(!1)},"game-won":function(n){return e.showSnackbar(!0)},send:e.sendMessage,"update:flagged-cells":function(n){return e.flaggedCells=n}}}):e._e()],1),t("v-snackbar",{attrs:{color:e.snackbarColour,top:""},scopedSlots:e._u([e.showingRefreshInSnackbar?{key:"action",fn:function(n){var o=n.attrs;return[t("v-btn",e._b({attrs:{icon:""},on:{click:function(){e.refresh(),e.showingSnackbar=!1}}},"v-btn",o,!1),[t("v-icon",[e._v(" mdi-refresh ")])],1)]}}:null],null,!0),model:{value:e.showingSnackbar,callback:function(n){e.showingSnackbar=n},expression:"showingSnackbar"}},[e._v(" "+e._s(e.snackbarText)+" ")])],1)},c=[],a=t("1da1"),l=(t("96cf"),t("d3b7"),function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"pt-12",staticStyle:{"touch-action":"manipulation"}},[t("v-row",{staticStyle:{"min-width":"fit-content"},attrs:{justify:"center","no-gutters":""}},[t("v-col",{staticStyle:{border:"1px solid grey"},attrs:{cols:"auto"}},e._l(e.blocks,(function(n,o){return t("v-row",{key:"row-"+o,staticClass:"flex-nowrap",attrs:{"no-gutters":""}},e._l(n,(function(n,r){return t("v-col",{key:"row-"+o+"-col-"+r,attrs:{cols:"auto"}},[t("v-hover",{scopedSlots:e._u([{key:"default",fn:function(i){var s=i.hover;return[t("v-btn",{staticClass:"px-0 text-body-1 font-weight-bold",staticStyle:{"box-sizing":"border-box",border:"1px solid #272727",color:"#b8b8b8"},style:{"background-color":!s||n.isVisible||n.isFlagged?e.getColour(o,r):"#555"},attrs:{dark:"",disabled:e.messedUp&&!n.isMine,large:"",icon:"",plain:"",tile:""},on:{mouseover:function(n){return e.sendHoverData(o,r)},click:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.preventDefault(),t.stopPropagation(),function(){return e.mobileMode?n.isVisible?e.middleClick(o,r):e.rightClick(o,r):e.leftClick(o,r)}.apply(null,arguments))},mouseup:function(n){return"button"in n&&1!==n.button?null:(n.preventDefault(),n.stopPropagation(),e.middleClick(o,r))},contextmenu:function(n){return n.preventDefault(),n.stopPropagation(),function(){return e.mobileMode?e.leftClick(o,r):e.rightClick(o,r)}.apply(null,arguments)}}},[n.isFlagged||e.isGameWon?t("span",[t("v-icon",{attrs:{large:"",color:"green"}},[e._v(" mdi-flag ")])],1):e.messedUp&&n.isMine?t("span",[t("v-icon",{attrs:{large:"",color:"error"}},[e._v(" mdi-mine ")])],1):n.isVisible&&0!==n.surrounding?t("span",[e._v(" "+e._s(n.surrounding)+" ")]):t("span",[e._v("Â ")])])]}}],null,!0)})],1)})),1)})),1)],1)],1)}),u=[],d=t("3835"),f=t("2909"),b=(t("a9e3"),t("99af"),t("4de4"),t("a630"),t("3ca3"),t("159b"),t("a0bc")),m=t.n(b);function v(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Math.ceil(n),o=Math.floor(e);return Math.floor(Math.random()*(o-t)+t)}var h={props:{mobileMode:{type:Boolean,default:!1},numberOfCols:{type:Number,default:30},numberOfMines:{type:Number,default:99},numberOfRows:{type:Number,default:16}},data:function(){return{blocks:[],connHoverRow:-1,connHoverCol:-1,numberOfFlaggedCells:0,preventHoverEmit:!1,messedUp:!1,zeroClicks:!0}},computed:{flattenedBlocks:function(){return this.blocks.reduce((function(e,n){return[].concat(Object(f["a"])(e),Object(f["a"])(n))}),[])},isGameWon:function(){return!this.messedUp&&this.flattenedBlocks.filter((function(e){return!e.isVisible})).length===this.numberOfMines}},watch:{isGameWon:function(e){e&&this.$emit("game-won")},messedUp:function(e){e&&this.$emit("game-lost")}},created:function(){var e=this;this.blocks=Array.from({length:this.numberOfRows},(function(){return Array.from({length:e.numberOfCols},(function(){return{}}))}));var n=new m.a;this.peerConn=n.connect("hopefully-a-completely-random-peers-js-id-to-be-used-for-minesweeper");var t=this;this.peerConn.on("data",(function(e){"left-click"===e.action&&t.leftClick(e.row,e.col),"right-click"===e.action&&t.rightClick(e.row,e.col),"middle-click"===e.action&&t.middleClick(e.row,e.col)}))},methods:{getColour:function(e,n){return this.messedUp?"error darken-2":this.connHoverRow===e&&this.connHoverCol===n?"#363683":this.blocks[e][n].isVisible?"#363636":"#222"},getText:function(e){return e.isVisible?e.surrounding:"-"},markRandomBlockAsMine:function(){var e=v(this.numberOfCols),n=v(this.numberOfRows);this.blocks[n][e].isMine||this.blocks[n][e].preventMine?this.markRandomBlockAsMine():this.$set(this.blocks[n][e],"isMine",!0)},initialiseBlocks:function(){var e=this;Array.from({length:this.numberOfMines},(function(){return null})).forEach((function(){return e.markRandomBlockAsMine()}));for(var n=0;n<this.numberOfRows;n+=1)for(var t=0;t<this.numberOfCols;t+=1)e.setNumberOfSurroundingMines(n,t);this.$emit("send",{action:"init-blocks",blocks:this.blocks})},setBlocks:function(e){this.zeroClicks=!1,this.blocks=e},setConnHover:function(e,n){this.connHoverRow=e,this.connHoverCol=n},sendHoverData:function(e,n){if(!this.preventHoverEmit){this.$emit("send",{action:"hover",col:n,row:e});var t=this;t.preventHoverEmit=!0,setTimeout((function(){t.preventHoverEmit=!1}),100)}},leftClick:function(e,n){var t=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.messedUp){var r=this;if(this.zeroClicks){var i=this.getSurroundingCells(e,n);i.forEach((function(e){var n=Object(d["a"])(e,2),t=n[0],o=n[1];r.preventMinesOnSurroundingBlocks(t,o)})),this.initialiseBlocks(),this.zeroClicks=!1}o||this.$emit("send",{action:"left-click",row:e,col:n});var s=this.blocks[e][n];if(!s.isFlagged&&!s.isVisible)if(this.$set(this.blocks[e][n],"isVisible",!0),s.isMine)this.messedUp=!0;else if(0===s.surrounding){var c=this.getSurroundingCells(e,n);c.forEach((function(e){var n=Object(d["a"])(e,2),o=n[0],r=n[1],i=t.hasZeroSurrounding;(i||(i(o,r-1)||i(o,r+1))&&(i(o-1,r)||i(o+1,r)))&&t.leftClick(o,r,!0)}))}}},hasZeroSurrounding:function(e,n){var t=this.blocks[e]||[],o=t[n]||{};return 0===o.surrounding},preventMinesOnSurroundingBlocks:function(e,n){var t=this,o=this.getSurroundingCells(e,n);t.blocks[e][n].preventMine=!0,o.forEach((function(e){var n=Object(d["a"])(e,2),o=n[0],r=n[1];t.blocks[o][r].preventMine=!0}))},middleClick:function(e,n,t){var o=this,r=this.blocks[e][n],i=this.getSurroundingCells(e,n),s=i.filter((function(e){var n=Object(d["a"])(e,2),t=n[0],r=n[1];return o.blocks[t][r].isFlagged})).length;s>=r.surrounding&&i.forEach((function(e){var n=Object(d["a"])(e,2),t=n[0],r=n[1];return o.leftClick(t,r,!0)})),t||this.$emit("send",{action:"middle-click",row:e,col:n})},rightClick:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this.blocks[e][n];if(!this.blocks[e][n].isVisible){var r=o.isFlagged;this.$set(this.blocks[e][n],"isFlagged",!r),this.$emit("update:flagged-cells",this.numberOfFlaggedCells+=r?-1:1),t||this.$emit("send",{action:"right-click",row:e,col:n})}},getAdjacentCells:function(e,n){for(var t=[],o=0,r=[[e-1,n],[e+1,n],[e,n-1],[e,n+1]];o<r.length;o++){var i=Object(d["a"])(r[o],2),s=i[0],c=i[1];-1===s||-1===c||s===this.numberOfRows||c===this.numberOfCols||s===e&&c===n||t.push([s,c])}return t},getSurroundingCells:function(e,n){for(var t=[],o=0,r=[-1,0,1];o<r.length;o++)for(var i=r[o],s=0,c=[-1,0,1];s<c.length;s++){var a=c[s],l=e+i,u=n+a;-1===l||-1===u||l===this.numberOfRows||u===this.numberOfCols||l===e&&u===n||t.push([l,u])}return t},setNumberOfSurroundingMines:function(e,n){var t=this;if(!this.blocks[e][n].isMine){var o=this.getSurroundingCells(e,n),r=o.filter((function(e){var n=Object(d["a"])(e,2),o=n[0],r=n[1];return!!t.blocks[o][r].isMine}));this.$set(this.blocks[e][n],"surrounding",r.length)}}}},p=h,g=t("2877"),k=t("6544"),w=t.n(k),C=t("8336"),y=t("62ad"),O=t("ce87"),x=t("132d"),_=t("0fd9"),M=Object(g["a"])(p,l,u,!1,null,null,null),S=M.exports;w()(M,{VBtn:C["a"],VCol:y["a"],VHover:O["a"],VIcon:x["a"],VRow:_["a"]});var V=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"pa-12"},[t("v-row",[t("v-col",[t("v-card",[t("v-card-title",[e._v(" Invite someone ")]),t("v-card-subtitle",[e._v(" by sharing the following id ")]),t("v-card-text",[t("v-row",{attrs:{dense:""}},[t("v-col",{attrs:{id:"peer-connector-share-id"}},[e._v(" "+e._s(e.peerId)+" ")]),t("v-col",{attrs:{cols:"auto"}},[t("v-btn",{attrs:{icon:""},on:{click:function(n){return e.$emit("copy-to-clipboard","peer-connector-share-id")}}},[t("v-icon",[e._v(" mdi-content-copy ")])],1)],1)],1)],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{large:""},on:{click:function(n){return e.$emit("start-game")}}},[e._v(" Start game ")])],1)],1)],1),t("v-col",[t("v-card",[t("v-card-title",[e._v(" Join someone's game ")]),t("v-card-subtitle",[e._v(" by entering their id ")]),t("v-card-text",[t("v-text-field",{attrs:{label:"Connection id"},model:{value:e.connectionId,callback:function(n){e.connectionId=n},expression:"connectionId"}})],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{large:""},on:{click:e.useConnectionId}},[e._v(" Use connection id ")])],1)],1)],1)],1)],1)},R=[],$={data:function(){return{connectionId:"",peerId:""}},created:function(){var e=this;e.peer=new m.a,e.peer.on("open",(function(n){e.$emit("peer",n),e.peerId=n})),e.peer.on("connection",(function(n){e.startListening(n)}))},methods:{startListening:function(e){this.$emit("connected",e)},useConnectionId:function(){var e=this,n=e.peer.connect(this.connectionId);e.startListening(n)}}},j=$,I=t("b0af"),T=t("99d9"),B=t("2fa4"),E=t("8654"),H=Object(g["a"])(j,V,R,!1,null,null,null),A=H.exports;w()(H,{VBtn:C["a"],VCard:I["a"],VCardActions:T["a"],VCardSubtitle:T["b"],VCardText:T["c"],VCardTitle:T["d"],VCol:y["a"],VIcon:x["a"],VRow:_["a"],VSpacer:B["a"],VTextField:E["a"]});var P={name:"App",components:{Minesweeper:S,PeerConnector:A},data:function(){return{conn:null,flaggedCells:0,minesKey:0,mobileMode:!1,numberOfCols:30,numberOfRows:16,numberOfMines:99,peerId:"",showingRefreshInSnackbar:!1,showingSnackbar:!1,snackbarColour:"error",snackbarText:"",startedGame:!1}},computed:{remainingMines:function(){return(this.numberOfMines||0)-(this.flaggedCells||0)}},watch:{minesKey:function(){this.flaggedCells=0,this.showingSnackbar=!1}},methods:{copyToClipboard:function(e){if(document.selection){var n=document.body.createTextRange();n.moveToElementText(document.getElementById(e)),n.select().createTextRange(),document.execCommand("copy")}else if(window.getSelection){var t=document.createRange();t.selectNode(document.getElementById(e)),window.getSelection().addRange(t),document.execCommand("copy")}},handleConnection:function(e){var n=this;n.conn=e,n.conn.on("open",(function(){n.$refs.mines&&!n.$refs.mines.zeroClicks&&n.conn.send({action:"init-blocks",blocks:n.$refs.mines.blocks}),n.conn.on("data",(function(e){var t=e.action,o=e.blocks,r=e.row,i=e.col;"refresh"===t?n.minesKey+=1:"hover"===t?n.$refs.mines.setConnHover(r,i):"left-click"===t?n.$refs.mines.leftClick(r,i,!0):"middle-click"===t?n.$refs.mines.middleClick(r,i,!0):"right-click"===t?n.$refs.mines.rightClick(r,i,!0):"init-blocks"===t&&n.$refs.mines.setBlocks(o)}))}))},refresh:function(){this.sendMessage({action:"refresh"}),this.minesKey+=1},sendMessage:function(e){this.conn&&this.conn.send(e)},showSnackbar:function(){var e=arguments,n=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var o,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=!(e.length>0&&void 0!==e[0])||e[0],r=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout(e,n)})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),i=n.minesKey,!o){t.next=10;break}n.showingRefreshInSnackbar=!0,n.snackbarColour="success",n.snackbarText="Woot woot!",n.showingSnackbar=!0,t.next=22;break;case 10:return n.snackbarColour="error darken-2",n.snackbarText="Oh no!",n.showingRefreshInSnackbar=!1,n.showingSnackbar=!0,t.next=16,r(2500);case 16:return n.showingSnackbar=!1,t.next=19,r(500);case 19:n.snackbarText="It's ok",n.showingRefreshInSnackbar=!0,i===n.minesKey&&(n.showingSnackbar=!0);case 22:case"end":return t.stop()}}),t)})))()}}},U=P,F=t("7496"),G=t("40dc"),N=t("f6c4"),D=t("e449"),K=t("2db4"),z=t("b73d"),L=Object(g["a"])(U,s,c,!1,null,null,null),W=L.exports;w()(L,{VApp:F["a"],VAppBar:G["a"],VBtn:C["a"],VCard:I["a"],VCol:y["a"],VIcon:x["a"],VMain:N["a"],VMenu:D["a"],VRow:_["a"],VSnackbar:K["a"],VSpacer:B["a"],VSwitch:z["a"],VTextField:E["a"]});var J=t("f309");o["a"].use(J["a"]);var Z=new J["a"]({theme:{dark:!0}});o["a"].config.productionTip=!1,new o["a"]({vuetify:Z,render:function(e){return e(W)}}).$mount("#app"),document.onload=function(){return i()(document.body)}},"5e11":function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id="5e11"}});
//# sourceMappingURL=app.82bc8d43.js.map